= content_for :sidebar do
  - nav_list do
    %li= link_to glyph(:home).concat(" Home"), incidents_path
    %li= link_to glyph(:refresh).concat(' Clear Results'), incident_interactions_path(incident)
    %li= link_to glyph(:circle_arrow_left).concat(' Back'), :back

  %br
  %br

.search
  %h5 Search Interactions
  = simple_form_for :q, url: incident_interactions_path(incident), html: {method: :get} do |f|
    = f.input :title_cont, label: 'Title', required: false
    = f.input :content_cont, label: 'Content', required: false, as: :text
    = f.input :attachments_id_present, label: 'Has attached files', required: false,  as: :boolean
    = f.input :start_at_gteq, as: :date_time_picker, placeholder: 'Optional',input_html: {data: {format: "dd/MM/yyyy hh:mm:ss PP"}
    and
    = f.input :start_at_lteq, as: :date_time_picker, placeholder: 'Optional',input_html: {data: {format: "dd/MM/yyyy hh:mm:ss PP"}
    %br
    = f.input :target_date_gteq, as: :date_time_picker, placeholder: 'Optional',input_html: {data: {format: "dd/MM/yyyy hh:mm:ss PP"}
    and
    = f.input :target_date_lteq, as: :date_time_picker, placeholder: 'Optional',input_html: {data: {format: "dd/MM/yyyy hh:mm:ss PP"}
    %br
    = f.input :tags_name_in, label: 'Tags', collection: incident.tag_cloud, required: false, as: :check_boxes, item_wrapper_class: :inline



    %br
    = f.submit "Search", class: 'btn btn-primary'








.search-results
  %h3= "Search Results (#{interactions.result.size})"
  %ul.inline
    %li.header Sort By:
    %li= sort_link interactions, :start_at, "Start At", default_order: :desc
    %li.divider
    %li= sort_link interactions, :target_date, "Target Date", default_order: :desc
    %li.divider
    %li= sort_link interactions, :created, "Creation Date", default_order: :desc
    %li.divider
    %li= sort_link interactions, :title, "Title", default_order: :desc
    %hr
  - interactions.result.each do |interaction|
    = div_for interaction do
      %h4= interaction.title.titleize
      %p= simple_format(interaction.content)
      %ul.inline{id: 'attachments'}
        -interaction.attachments.each do |a|
          %li= link_to glyph(:file).concat( a.name.titleize), download_attachment_path(a), target: '_blank'
      %div
        %contact_detail= interaction.contact_info.presence
        %start_date= "Started #{l Time.zone.at(interaction.start_at)}" if interaction.start_at
        .pull-right
          - interaction.tag_names.each do |tag_name|
            %tags
              =tag_name
    %hr